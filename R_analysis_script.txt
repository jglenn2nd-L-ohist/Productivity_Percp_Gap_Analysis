# Load Libraries 
library(ggplot2)

# Preliminary visualization of data

# --- Productivity Gap Distribution ---
# Visualize the distribution of the Productivity Gap to see the general trend.

print("--- 1. Productivity Gap Distribution ---")

ggplot(df_final_analysis, aes(x = productivity_gap)) +
  geom_histogram(binwidth = 1, fill = "lightblue", color = "darkblue") +
  geom_vline(aes(xintercept = mean(productivity_gap, na.rm = TRUE)), 
             color = "red", linetype = "dashed", linewidth = 1) +
  labs(
    title = "Distribution of the Productivity Gap",
    subtitle = "Positive values mean one Over-estimated productivity (Perceived > Actual)",
    x = "Productivity Gap Score (Perceived - Actual)",
    y = "Frequency (Count)"
  ) +
  theme_minimal()

# ---  Relationship between Screen Time and Productivity Gap ---
# Use a Box Plot to compare the average gap across the Screen Time categories.

print("--- 2. Screen Time vs. Productivity Gap ---")

ggplot(df_final_analysis, aes(x = screen_time_category, y = productivity_gap, fill = screen_time_category)) +
  geom_boxplot() +
  labs(
    title = "Productivity Gap by Screen Time Before Sleep",
    subtitle = "Does high screen time correlate with over-estimating productivity?",
    x = "Screen Time Category",
    y = "Productivity Gap (Perceived - Actual)"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")

# --- Relationship between Sleep Hours and Productivity Gap ---
# Use a Box Plot to compare the average gap across the Sleep Hours categories.

print("--- 3. Sleep Hours vs. Productivity Gap ---")

ggplot(df_final_analysis, aes(x = sleep_hours_category, y = productivity_gap, fill = sleep_hours_category)) +
  geom_boxplot() +
  labs(
    title = "Productivity Gap by Sleep Hours Category",
    subtitle = "How does sleep quantity influence the accuracy of self-perception?",
    x = "Sleep Hours Category",
    y = "Productivity Gap (Perceived - Actual)"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

# --- Correlation Check (Scatter Plot for Continuous Variables) ---
# Check the direct continuous relationship between screen time and the gap.

print("--- 4. Continuous Relationship Check ---")

ggplot(df_final_analysis, aes(x = screen_time_before_sleep, y = productivity_gap)) +
  geom_point(alpha = 0.6, color = "darkred") +
  geom_smooth(method = "lm", color = "blue", se = FALSE) + # Add a linear trend line
  labs(
    title = "Screen Time vs. Productivity Gap (Continuous)",
    x = "Screen Time Before Sleep (Hours)",
    y = "Productivity Gap (Perceived - Actual)"
  ) +
  theme_minimal()

# --- Create Multiple Linear Regression to determine the underlying trends and relationships
# Linear Regression Model Formulation
# We are testing the hypothesis: 
# Does Screen Time and Sleep Hours significantly predict the Productivity Gap?

# Formula: Gap ~ Screen Category + Sleep Category + Continuous Sleep Hours
model_mlr <- lm(
  productivity_gap ~ screen_time_category + sleep_hours_category + sleep_hours, 
  data = df_final_analysis
)

# 2. Review Model Summary
# The summary provides the coefficients, standard errors, t-values, and p-values.
print("--- Multiple Linear Regression Model Summary ---")
summary(model_mlr)

# 3. Analyze Model Assumptions 

plot(model_mlr, which = 1)
